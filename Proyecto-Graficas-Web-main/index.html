<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoRunner</title>

    <link rel="stylesheet" href="/Proyecto-Graficas-Web-main/Public/css/styles.css">
    <link rel="stylesheet" href="/Proyecto-Graficas-Web-main/Public/css/modal.css">

    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script src="/socket.io/socket.io.js"></script>

    <style>
        #time-counter {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Arial', sans-serif;
            font-size: 50px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px #000000;
            z-index: 100;
            pointer-events: none;
            /* Para que no estorbe al clickear */
            display: none;
            /* Se oculta en los men√∫s, se muestra al jugar */
        }

        /* Ocultar elementos por defecto para manejarlos con JS */
        #welcome-message,
        #start-button {
            display: none;
        }
    </style>
</head>

<body>

    <div id="MenuInicio" class="MenuDeInicio">
        <div class="MenuDeInicio-contenido">
            <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Logo.png" alt="Logo" class="logo">

            <div id="g_id_onload"
                data-client_id="770684243514-ihds2q7b9ahb5oecjl1rhglbcmimipd4.apps.googleusercontent.com"
                data-callback="handleCredentialResponse" data-auto_prompt="false">
            </div>
            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
            </div>

            <p id="welcome-message" class="instrucciones">
                ¬°Hola, <span id="user-name" style="color: #e6ff04; font-weight: bold;">Jugador</span>!
            </p>

            <p id="start-button" class="instrucciones" style="cursor: pointer; text-decoration: underline;">
                > PRESIONA CLICK PARA ENTRAR < </p>
        </div>
    </div>

    <div id="MainMenu" class="MainMenu" style="display: none;">
        <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Logo2.png" alt="Logo" class="logo2">
        <div class="MainMenu-contenido">
            <button class="menu-button" id="jugar-button">Jugar</button>
            <button class="menu-button" id="options-button">Opciones</button>
            <button class="menu-button" id="score-button">Puntuaciones</button>
            <!-- <button class="menu-button" id="post-button">Publicaci√≥n</button> -->
            <button class="menu-button" id="back-to-menu-button">Salir</button>
        </div>
    </div>

    <div id="GameMenu" class="GameMenu" style="display: none;">
        <h2 class="game-menu-title">Selecciona un modo</h2>
        <div class="GameMenu-opciones">
            <div class="game-option" data-mode="solitario">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Solitario.png" alt="Solitario"
                    class="game-image">
                <p>Solitario</p>
            </div>
            <div class="game-option" data-mode="multijugador">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Multijugador.png" alt="Multijugador"
                    class="game-image">
                <p>Multijugador</p>
            </div>
        </div>
        <button class="menu-button" id="back-to-main-menu">Regresar</button>
    </div>

    <div id="LevelMenu" class="LevelMenu" style="display: none;">
        <h2 class="level-title">Selecciona un nivel</h2>
        <div class="level-options">
            <div class="level-option" data-level="plano">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/1.png" class="level-image">
                <p>Nivel 1</p>
            </div>
            <div class="level-option" data-level="obstaculos">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/2.png" class="level-image">
                <p>Nivel 2</p>
            </div>
            <div class="level-option" data-level="laberinto">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/3.png" class="level-image">
                <p>Nivel 3</p>
            </div>
        </div>
        <button class="menu-button" id="back-from-level">Regresar</button>
    </div>

    <div id="OptionsMenu" class="OptionsMenu" style="display: none;">
        <h2 class="options-title">Opciones</h2>
        <button class="menu-button" id="back-from-options">Regresar</button>
    </div>

<div id="scoreModal" class="modal" style="display:none;">
        <div class="modal-content large-modal">
            <span id="closeScoreModal" class="close">&times;</span>
            <h2>üèÜ TABLA DE L√çDERES üèÜ</h2>
            
            <div class="scores-container" style="display: flex; justify-content: space-around; gap: 10px;">
                <div style="flex: 1;">
                    <h3 style="color: #00d1ff;">Nivel 1</h3>
                    <ul id="list-nivel1" style="list-style: none; padding: 0; text-align: left;"></ul>
                </div>
                
                <div style="flex: 1; border-left: 1px solid #555; border-right: 1px solid #555; padding: 0 10px;">
                    <h3 style="color: #00d1ff;">Nivel 2</h3>
                    <ul id="list-nivel2" style="list-style: none; padding: 0; text-align: left;"></ul>
                </div>

                <div style="flex: 1;">
                    <h3 style="color: #00d1ff;">Nivel 3</h3>
                    <ul id="list-nivel3" style="list-style: none; padding: 0; text-align: left;"></ul>
                </div>
            </div>
        </div>
    </div>

    <div id="socialModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span id="closeSocialModal" class="close">&times;</span>
            <h2>Red Social</h2>
            <input type="text" id="usernameInput" placeholder="Usuario" readonly style="background-color: #ddd;" />
            <textarea id="postContent" placeholder="Comparte tu logro..." rows="3"></textarea>
            <br>
            <button id="sendPost">Publicar en Twitter</button>
            <hr>
            <div id="postsContainer"></div>
        </div>
    </div>

    <div id="gameContainer" style="display:none;"></div>

    <div id="time-counter">30</div>

    <div id="orbCounter"
        style="position: absolute; top: 20px; right: 20px; color: white; font-size: 24px; font-weight: bold; display: none;">
        Orbes: 0
    </div>

    <div id="energy-bar" style="position: absolute; top: 20px; left: 20px; display: none;">
        <img id="barra-energia-img" src="/Proyecto-Graficas-Web-main/Resources/UI/HUH.png" width="200">
    </div>

    <div id="audio-icon" class="audio-icon" style="display: none;"> <img
            src="/Proyecto-Graficas-Web-main/Resources/Imagenes/SonidoOFF.png" id="audio-img">
    </div>

    <audio id="background-music" loop>
        <source src="/Proyecto-Graficas-Web-main/Resources/Audio/Hi-Fi Rush OST The Rush.mp3" type="audio/mpeg">
    </audio>

    <div class="creditos">
        <p>ABRANCHILL Studios &copy; 2025</p>
    </div>

    <script>
        // Variables Globales para que el juego sepa qui√©n eres y c√≥mo jugar
        window.currentUser = null;      // Guardar√° { id, username, picture }
        window.isMultiplayer = false;   // true = conectar a Socket.io

        // --- FUNCI√ìN QUE LLAMA GOOGLE AL LOGUEARSE ---
        function handleCredentialResponse(response) {
            console.log("Token recibido de Google...");

            // Enviamos el token a NUESTRO backend (server.js)
            fetch('http://localhost:3000/auth/google', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: response.credential })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        // LOGIN EXITOSO
                        console.log("Usuario autenticado:", data.user);
                        window.currentUser = data.user;

                        sessionStorage.setItem('currentUser', JSON.stringify(data.user));

                        // Actualizar UI del Men√∫ Inicio
                        document.querySelector('.g_id_signin').style.display = 'none'; // Ocultar bot√≥n Google
                        document.getElementById('user-name').innerText = data.user.username;
                        document.getElementById('welcome-message').style.display = 'block';
                        document.getElementById('start-button').style.display = 'block';

                        // Pre-llenar el modal social
                        document.getElementById('usernameInput').value = data.user.username;
                    } else {
                        alert("Error de autenticaci√≥n: " + data.message);
                    }
                })
                .catch(err => console.error("Error conectando con el servidor:", err));
        }

        // --- L√ìGICA DE SELECCI√ìN DE MODO (SOLO/MULTI) ---
        document.addEventListener('DOMContentLoaded', () => {
            const gameOptions = document.querySelectorAll('.game-option');

            gameOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const mode = option.getAttribute('data-mode');

                    if (mode === 'multijugador') {
                        console.log("Modo MULTIJUGADOR seleccionado");
                        // CAMBIO IMPORTANTE: Guardar en sessionStorage
                        sessionStorage.setItem('isMultiplayer', 'true');
                    } else {
                        console.log("Modo SOLITARIO seleccionado");
                        // CAMBIO IMPORTANTE: Guardar en sessionStorage
                        sessionStorage.setItem('isMultiplayer', 'false');
                    }

                    // Visualmente podr√≠as marcar cu√°l est√° seleccionado aqu√≠ si quisieras
                });
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

    <script src="/Proyecto-Graficas-Web-main/Public/js/main.js" type="module"></script>
    <script src="/Proyecto-Graficas-Web-main/Public/js/menus.js"></script>
    <script src="/Proyecto-Graficas-Web-main/Public/js/GameManager.js"></script>
    <script src="/Proyecto-Graficas-Web-main/Public/js/social.js"></script>

</body>

</html>