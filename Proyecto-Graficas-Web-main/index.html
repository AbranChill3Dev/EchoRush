<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoRunner</title>

    <link rel="stylesheet" href="/Proyecto-Graficas-Web-main/Public/css/styles.css">
    <link rel="stylesheet" href="/Proyecto-Graficas-Web-main/Public/css/modal.css">

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="/socket.io/socket.io.js"></script>

    <style>
        #time-counter {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Arial', sans-serif;
            font-size: 50px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px #000000;
            z-index: 100;
            pointer-events: none;
            display: none;
        }

        #welcome-message, #start-button {
            display: none;
        }
        
        .scores-container { display: flex; justify-content: space-around; gap: 10px; }
        .score-column { flex: 1; }
        .score-column ul { list-style: none; padding: 0; text-align: left; }
        .score-column li { border-bottom: 1px solid #444; padding: 5px; display: flex; justify-content: space-between; }
    </style>
</head>

<body>

    <div id="MenuInicio" class="MenuDeInicio">
        <div class="MenuDeInicio-contenido">
            <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Logo.png" alt="Logo" class="logo">

            <div id="g_id_onload"
                data-client_id="770684243514-ihds2q7b9ahb5oecjl1rhglbcmimipd4.apps.googleusercontent.com"
                data-callback="handleCredentialResponse" data-auto_prompt="false">
            </div>
            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
            </div>

            <p id="welcome-message" class="instrucciones">
                ¬°Hola, <span id="user-name" style="color: #e6ff04; font-weight: bold;">Jugador</span>!
            </p>

            <p id="start-button" class="instrucciones" style="cursor: pointer; text-decoration: underline;">
                > PRESIONA CLICK PARA ENTRAR < 
            </p>
        </div>
    </div>

    <div id="MainMenu" class="MainMenu" style="display: none;">
        <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Logo2.png" alt="Logo" class="logo2">
        <div class="MainMenu-contenido">
            <button class="menu-button" id="jugar-button">Jugar</button>
            <button class="menu-button" id="score-button">Puntuaciones</button>
            <button class="menu-button" id="back-to-menu-button">Salir</button>
        </div>
    </div>

    <div id="GameMenu" class="GameMenu" style="display: none;">
        <h2 class="game-menu-title">Selecciona un modo</h2>
        <div class="GameMenu-opciones">
            <div class="game-option" data-mode="solitario">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Solitario.png" alt="Solitario" class="game-image">
                <p>Solitario</p>
            </div>
            <div class="game-option" data-mode="multijugador">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/Multijugador.png" alt="Multijugador" class="game-image">
                <p>Multijugador</p>
            </div>
        </div>
        <button class="menu-button" id="back-to-main-menu">Regresar</button>
    </div>

    <div id="DifficultyMenu" class="MainMenu" style="display: none;">
        <h2 style="color:white; font-family: 'Impact', sans-serif; font-size: 3rem; margin-bottom: 50px; text-shadow: 2px 2px 0px black;">
            Selecciona la Dificultad
        </h2>
        <div class="MainMenu-contenido" style="margin-top: 0;">
            <button class="menu-button" id="normal-button">Normal</button>
            <button class="menu-button" id="hard-button" style="background-color: #ff4d4d;">Dif√≠cil</button>
            <button class="menu-button" id="back-from-difficulty">Regresar</button>
        </div>
    </div>

    <div id="LevelMenu" class="LevelMenu" style="display: none;">
        <h2 class="level-title">Selecciona un nivel</h2>
        <div class="level-options">
            <div class="level-option" data-level="plano">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/1.png" class="level-image">
                <p>Nivel 1</p>
            </div>
            <div class="level-option" data-level="obstaculos">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/2.png" class="level-image">
                <p>Nivel 2</p>
            </div>
            <div class="level-option" data-level="laberinto">
                <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/3.png" class="level-image">
                <p>Nivel 3</p>
            </div>
        </div>
        <button class="menu-button" id="back-from-level">Regresar</button>
    </div>

    <div id="OptionsMenu" class="OptionsMenu" style="display: none;">
        <h2 class="options-title">Opciones</h2>
        <button class="menu-button" id="back-from-options">Regresar</button>
    </div>

    <div id="scoreModal" class="modal" style="display:none;">
        <div class="modal-content large-modal" style="width: 90%; max-width: 1000px;">
            <span id="closeScoreModal" class="close">&times;</span>
            <h2>üèÜ SAL√ìN DE LA FAMA üèÜ</h2>
            
            <div class="scores-container">
                <div class="score-column">
                    <h3 style="color: #00d1ff; text-align: center;">Nivel 1</h3>
                    <ul id="list-nivel1"></ul>
                </div>
                
                <div class="score-column" style="border-left: 1px solid #555; border-right: 1px solid #555; padding: 0 10px;">
                    <h3 style="color: #00d1ff; text-align: center;">Nivel 2</h3>
                    <ul id="list-nivel2"></ul>
                </div>

                <div class="score-column">
                    <h3 style="color: #00d1ff; text-align: center;">Nivel 3</h3>
                    <ul id="list-nivel3"></ul>
                </div>
            </div>
        </div>
    </div>

    <div id="gameContainer" style="display:none;"></div>
    <div id="time-counter">30</div>

    <div id="audio-icon" class="audio-icon" style="display: none;"> 
        <img src="/Proyecto-Graficas-Web-main/Resources/Imagenes/SonidoOFF.png" id="audio-img">
    </div>

    <audio id="background-music" loop>
        <source src="/Proyecto-Graficas-Web-main/Resources/Audio/Hi-Fi Rush OST The Rush.mp3" type="audio/mpeg">
    </audio>

    <div class="creditos">
        <p>ABRANCHILL Studios &copy; 2025</p>
    </div>

    <script>
        window.currentUser = null;
        window.isMultiplayer = false;

        function handleCredentialResponse(response) {
            console.log("Token recibido...");
            fetch('http://localhost:3000/auth/google', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: response.credential })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    console.log("Usuario autenticado:", data.user);
                    window.currentUser = data.user;
                    sessionStorage.setItem('currentUser', JSON.stringify(data.user));
                    
                    document.querySelector('.g_id_signin').style.display = 'none';
                    document.getElementById('user-name').innerText = data.user.username;
                    document.getElementById('welcome-message').style.display = 'block';
                    document.getElementById('start-button').style.display = 'block';
                    
                    const userInput = document.getElementById('usernameInput');
                    if(userInput) userInput.value = data.user.username;
                } else {
                    alert("Error de autenticaci√≥n: " + data.message);
                }
            })
            .catch(err => console.error("Error conectando con el servidor:", err));
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
    <script src="/Proyecto-Graficas-Web-main/Public/js/main.js" type="module"></script>
    <script src="/Proyecto-Graficas-Web-main/Public/js/menus.js"></script>
    <script src="/Proyecto-Graficas-Web-main/Public/js/GameManager.js"></script>
    </body>
</html>